<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <link rel="stylesheet" th:href="@{/component/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/component/pear/css/pear.css}" />

    <script th:src="@{/component/layui/layui.js}"></script>
</head>
<body style="min-height: 1000px;">
<form class="layui-form" action="">
    <div class="mainBox">
        <div class="main-container">
            <div class="main-container">

                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span style="color: red">*</span>真实姓名
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="name"  name="name"  required="" placeholder="请输入真实姓名" lay-verify="required" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span style="color: red">*</span>身份证号
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="identity"  name="identity"required="" placeholder="请输入身份证号" lay-verify="identity" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span style="color: red">*</span>手机号
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="phone"  name="phone" required="" placeholder="请输入手机号" autocomplete="off" lay-verify="phone" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span style="color: red">*</span>开始日期
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="start" name="createTime" class="layui-input" lay-verify="required" placeholder="yyyy-MM-dd">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">
                        <span style="color: red">*</span>结束日期
                    </label>
                    <div class="layui-input-inline">
                        <input type="text" id="end" name="endTime" class="layui-input" lay-verify="required"  placeholder="yyyy-MM-dd">
                    </div>
                </div>
                <div class="layui-upload">
                    <button type="button" class="layui-btn" id="test2">上传</button>（<span style="color: red">*</span>请上传身份证和驾驶证照片）
                    <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                        预览图：
                        <div class="layui-upload-list" id="demo2"></div>
                    </blockquote>
                </div>
                <div>
                    <input type="hidden" id="carId" th:value="${car.id}" name="carId" >
                    <input type="hidden" id="price" th:value="${car.price}" name="price" >
                    <input type="hidden" id="deposit" th:value="${car.deposit}" name="deposit" >
                    <input type="hidden" id="customerId" sec:authentication="principal.MyUser.userId" name="customerId" >
                    <input type="hidden" id="na" sec:authentication="principal.MyUser.nickName" name="na" >
                </div>
            </div>
        </div>
    </div>
    <div class="bottom">
        <div class="button-container">
            <button type="submit" class="layui-btn layui-btn-normal layui-btn-sm" lay-submit="" lay-filter="car-save">
                <i class="layui-icon layui-icon-ok"></i>
                提交
            </button>
            <button type="reset" class="layui-btn layui-btn-primary layui-btn-sm">
                <i class="layui-icon layui-icon-refresh"></i>
                重置
            </button>
        </div>
    </div>
</form>
<script type="text/javascript" src="/component/jquery/jquery.min.js"></script>
<script>
    layui.use(['upload','form','laydate','jquery'],function(){

        let form = layui.form;
        let $ = layui.jquery;
        let upload = layui.upload;
        var carId = $("#carId").val();
        var laydate = layui.laydate;


        //自定义格式
        laydate.render({
            elem: '#start',
            trigger: 'click'//呼出事件改成click
        });
        //自定义格式
        laydate.render({
            elem: '#end',
            trigger: 'click'//呼出事件改成click
        });
        form.verify({
            required: [/[\S]+/, "必填项不能为空"],
            phone: [/^1\d{10}$/, "请输入正确的手机号"],
            email: [/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/, "邮箱格式不正确"],
            url: [/(^#)|(^http(s*):\/\/[^\s]+\.[^\s]+)/, "链接格式不正确"],
            number: function(e) {
            if (!e || isNaN(e)) return "只能填写数字"
            },
            date: [/^(\d{4})[-\/](\d{1}|0\d{1}|1[0-2])([-\/](\d{1}|0\d{1}|[1-2][0-9]|3[0-1]))*$/, "日期格式不正确"],
            identity: [/(^\d{15}$)|(^\d{17}(x|X|\d)$)/, "请输入正确的身份证号"]
        });
        //多图片上传
        upload.render({
            elem: '#test2'
            ,url: '/api/document/upload' //改成您自己的上传接口
            ,data:{
                carDetailId:function () {
                    return $('#id').val();
                }
            }
            ,multiple: true
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#demo2').append('<img src="'+ result +'" alt="'+ file.name +'" class="layui-upload-img" width="50%">')
                });
            }
            ,done: function(res){
                //上传完毕
            }
        });

        form.on('submit(car-save)', function(data){
            var datas = data.field;
            $.ajax({
                url:'/api/carRecord/add',
                data:JSON.stringify(datas),
                dataType:'json',
                contentType:'application/json',
                type:'post',
                success:function(result){
                    if(result.success){
                        layer.msg(result.msg,{icon:1,time:1000},function(){
                            parent.layer.close(parent.layer.getFrameIndex(window.name));//关闭当前页
                            parent.location.reload();
                        });
                    }else{
                        layer.msg(result.msg,{icon:2,time:1000});
                    }
                }
            })
            return false;
        });
    })

</script>
<script>
</script>
</body>
</html>